<section>
  <center>
    <h1 class="title">CASSI Autonomous Shuttle Pilot</h1>
    <ods-dataset-context
      context="autonomousshuttleusage"
      autonomousshuttleusage-dataset="autonomous-shuttle-usage"
      ng-init="values = {};"
    >
      <p class="kpi-description">
        Last Updated:<span class="kpi-value2">
          {{ autonomousshuttleusage.dataset.metas.metadata_processed | date
          }}</span
        >
      </p>
    </ods-dataset-context>
  </center>
</section>
<section>
  <div class="container">
    <div class="column">
      <div class="col-md-6">
        <center>
          <img
            class="shuttle-image"
            src="https://data.townofcary.org/assets/theme_image/autonomous_shuttle_profile.png"
            alt="A small self-driving bus parked with a forest in the background."
          />
        </center>
      </div>
      <div
        class="col-md-6"
        style="display: flex; justify-content: center; align-items: center"
      >
        <p>
          During a 12-week period between March 6 and June 2, 2023, Fred G. Bond
          Metro Park is the site of an exciting demonstration in autonomous
          vehicle technology. The North Carolina Department of Transportation
          (NCDOT) has partnered with Cary to bring an all-electric, driverless
          shuttle to Bond Park. CASSI (Connected Autonomous Shuttle Supporting
          Innovation) runs a route from the Cary Senior Center to Bond Park
          Community Center on weekdays from 10:00 a.m. to 4:00 p.m.
          <br />
          <br />
          Please see Cary's
          <a
            href="https://www.carync.gov/projects-initiatives/smart-connected-communities-program/cassi"
            >article on CASSI</a
          >
          for more information on the Fred G. Bond Metro Park route. Look to
          <a
            href="https://www.ncdot.gov/divisions/integrated-mobility/innovation/cassi/Pages/default.aspx"
            >NCDOT's article</a
          >
          for further information on the CASSI projects within the North
          Carolina.
        </p>
      </div>
    </div>
  </div>
</section>
<section>
  <div class="container">
    <center>
      <h2>Stops & Route</h2>
    </center>
    <ods-dataset-context
      context="cassiautonomousshuttlestops,cassiautonomousshuttleroute"
      cassiautonomousshuttlestops-dataset="cassi-autonomous-shuttle-stops"
      cassiautonomousshuttleroute-dataset="cassi-autonomous-shuttle-route"
    >
      <ods-map
        no-refit="true"
        scroll-wheel-zoom="false"
        toolbar-fullscreen="true"
        basemap="jawg.streets"
        location="16,35.78426,-78.82409"
      >
        <ods-map-layer-group>
          <ods-map-layer
            context="cassiautonomousshuttlestops"
            color="#C32D1C"
            picto="ods-bus_stop"
            show-marker="false"
            display="auto"
            shape-opacity="0.5"
            point-opacity="1"
            border-color="#FFFFFF"
            border-opacity="1"
            border-size="1"
            border-pattern="solid"
            caption="true"
            title="CASSI Autonomous Shuttle Stops"
            description="Shuttle stops for the CASSI Autonomous Shuttle Pilot pilot program.Partnering with North Carolina Department of Transportation (NCDOT) to bring the Connected Autonomous Shuttle Supporting Innovatio…"
            size="7"
            size-min="3"
            size-max="5"
            size-function="linear"
          ></ods-map-layer>
        </ods-map-layer-group>
        <ods-map-layer-group>
          <ods-map-layer
            context="cassiautonomousshuttleroute"
            color="#C32D1C"
            picto="ods-circle"
            show-marker="true"
            display="auto"
            shape-opacity="0.5"
            point-opacity="1"
            border-color="#FFFFFF"
            border-opacity="1"
            border-size="1"
            border-pattern="solid"
            caption="true"
            title="CASSI Autonomous Shuttle Route"
            description="Shuttle route for the CASSI Autonomous Shuttle Pilot pilot program.Partnering with North Carolina Department of Transportation (NCDOT) to bring the Connected Autonomous Shuttle Supporting Innovatio…"
            size="4"
            size-min="3"
            size-max="5"
            size-function="linear"
          ></ods-map-layer>
        </ods-map-layer-group>
      </ods-map>
    </ods-dataset-context>
  </div>
</section>
<br />
<section>
  <div class="container">
    <center>
      <h2>Ridership & Affecting Factors</h2>
    </center>
    <ods-dataset-context
      context="autonomousshuttleusage"
      autonomousshuttleusage-dataset="autonomous-shuttle-usage"
    >
      <div class="row">
        <div class="col-sm-offset-4 col-sm-4">
          <!-- KPI box component -->
          <div class="kpi-card">
            <i class="kpi-icon fa fa-bus" aria-hidden="true"></i>
            <p
              class="kpi-title"
              ods-aggregation="myvar"
              ods-aggregation-context="autonomousshuttleusage"
              ods-aggregation-function="SUM"
              ods-aggregation-expression="number_of_passengers"
            >
              {{ myvar | number }}
            </p>
            <p class="kpi-description">Total Riders Served</p>
          </div>
        </div>
      </div>
    </ods-dataset-context>
    <div class="column">
      <div class="col-md-12">
        <div class="chart-title">
          <center>Ridership by Week</center>
          <ods-dataset-context
            context="autonomousshuttleusage"
            autonomousshuttleusage-dataset="autonomous-shuttle-usage"
          >
            <ods-chart scientific-display="false" align-month="true">
              <ods-chart-query
                context="autonomousshuttleusage"
                field-x="weeks_into_pilot"
                maxpoints="0"
              >
                <ods-chart-serie
                  expression-y="number_of_passengers"
                  chart-type="column"
                  function-y="SUM"
                  label-y="Number of Passengers"
                  color="#0073b3"
                  scientific-display="true"
                >
                </ods-chart-serie>
              </ods-chart-query>
            </ods-chart>
          </ods-dataset-context>
        </div>
        <div class="column">
          <div class="col-md-6">
            <div class="chart-title">
              <center>Ridership over Time</center>
            </div>
            <figure>
              <ods-dataset-context
                context="autonomousshuttleusage"
                autonomousshuttleusage-dataset="autonomous-shuttle-usage"
              >
                <ods-chart
                  timescale="day"
                  scientific-display="false"
                  align-month="true"
                >
                  <ods-chart-query
                    context="autonomousshuttleusage"
                    field-x="date"
                    maxpoints="0"
                    timescale="day"
                  >
                    <ods-chart-serie
                      expression-y="number_of_passengers"
                      chart-type="line"
                      function-y="SUM"
                      label-y="Number of Passengers"
                      color="#8da0cb"
                      step=""
                      scientific-display="true"
                    >
                    </ods-chart-serie>
                  </ods-chart-query>
                </ods-chart>
              </ods-dataset-context>
            </figure>
          </div>
          <div class="col-md-6">
            <div class="chart-title">
              <center>Hours of Operation over Time</center>
            </div>
            <ods-dataset-context
              context="autonomousshuttleusage"
              autonomousshuttleusage-dataset="autonomous-shuttle-usage"
            >
              <ods-chart
                timescale="day"
                scientific-display="false"
                align-month="true"
              >
                <ods-chart-query
                  context="autonomousshuttleusage"
                  field-x="date"
                  maxpoints="0"
                  timescale="day"
                >
                  <ods-chart-serie
                    expression-y="number_of_hours_operated"
                    chart-type="line"
                    function-y="SUM"
                    label-y="Hours of Operation"
                    color="#8da0cb"
                    step=""
                    scientific-display="true"
                  >
                  </ods-chart-serie>
                </ods-chart-query>
              </ods-chart>
            </ods-dataset-context>
          </div>
          <div class="col-md-12">
            <center>
              <h2>Most Popular Days of Week</h2>
            </center>
            <div class="chart-title">
              <center>Most Popular Days of Week by Ridership</center>
            </div>
            <ods-dataset-context
              context="autonomousshuttleusage"
              autonomousshuttleusage-dataset="autonomous-shuttle-usage"
            >
              <ods-chart
                timescale="day weekday"
                scientific-display="false"
                align-month="true"
              >
                <ods-chart-query
                  context="autonomousshuttleusage"
                  field-x="date"
                  maxpoints="0"
                  timescale="day weekday"
                  sort="serie1-1"
                >
                  <ods-chart-serie
                    expression-y="number_of_passengers"
                    chart-type="bar"
                    function-y="SUM"
                    label-y="Total Number of Passengers"
                    color="#0073b3"
                    scientific-display="true"
                  >
                  </ods-chart-serie>
                </ods-chart-query>
              </ods-chart>
            </ods-dataset-context>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<section>
  <div class="container">
    <div class="column">
      <center>
        <h2>Reasons for Disengagement of Autonomous Driving Mode</h2>
      </center>
      <p>
        The leading cause of disengagements of autonomous driving mode is the
        vehicle's Onboard Unit (OBU) losing connection or experiencing
        miscommunication with the Roadside Unit (RSU) at the intersection of
        Maury Odell Place and Metro Park Drive that communicates the status of
        the traffic signal with the OSU. The attendant resolves this issue by
        moving the vehicle within range of the RSU until the connection is
        reestablished, when they can resume autonomous driving mode.
      </p>
      <div class="col-md-12">
        <div class="chart-title">
          <center>Disengagements by Cause</center>
        </div>
        <ods-dataset-context
          context="autonomousshuttledisengagement"
          autonomousshuttledisengagement-dataset="autonomous-shuttle-disengagement"
        >
          <ods-chart
            scientific-display="false"
            labels-x-length="48"
            align-month="true"
          >
            <ods-chart-query
              context="autonomousshuttledisengagement"
              field-x="cause"
              maxpoints="0"
              sort="serie1-1"
            >
              <ods-chart-serie
                expression-y="vehicle_speed"
                chart-type="column"
                function-y="COUNT"
                color="#FE6260"
                scientific-display="true"
              >
              </ods-chart-serie>
            </ods-chart-query>
          </ods-chart>
        </ods-dataset-context>
      </div>
      <div class="col-md-12">
        <center>
          <h2>Where Did Autonomous Driving Mode Disengage?</h2>
        </center>
        <p>
          The maps below illustrate the density and reasons for the autonomous
          driving system disengaging, coming to a complete stop, and handing
          control back to the shuttle attendant until autonomous operation can
          resume. The first map, a heatmap, displays the density of these
          events, with darker colors indicating higher frequency of
          disengagement events. The second map shows the number of events and
          reasons behind each disengagement event.
        </p>
      </div>
      <div class="col-md-6">
        <div class="chart-title">
          <center class="laptop-width-fix">
            Density of Disengagement of Autonomous Operation Events
          </center>
        </div>
        <ods-dataset-context
          context="autonomousshuttledisengagement"
          autonomousshuttledisengagement-dataset="autonomous-shuttle-disengagement"
        >
          <ods-map
            no-refit="true"
            scroll-wheel-zoom="false"
            basemap="jawg.streets"
            location="16,35.7826,-78.82484"
          >
            <ods-map-layer-group>
              <ods-map-layer
                context="autonomousshuttledisengagement"
                color-gradient="{'1':'#FF0000','0.4':'#0000FF','0.6':'#00FFFF','0.7':'#00FF00','0.8':'#FFFF00'}"
                picto="ods-circle"
                show-marker="true"
                display="heatmap"
                radius="4"
                function="COUNT"
                expression="vehicle_speed"
                shape-opacity="0.5"
                point-opacity="1"
                border-color="#FFFFFF"
                border-opacity="1"
                border-size="1"
                border-pattern="solid"
                caption-picto-color="#E5E5E5"
                size-function="linear"
              ></ods-map-layer>
            </ods-map-layer-group>
          </ods-map>
        </ods-dataset-context>
      </div>
      <div class="col-md-6">
        <div class="chart-title add-whitespace">
          <center>
            Number and Reasons for Disengagement of Autonomous Operation Events
          </center>
        </div>
        <ods-dataset-context
          context="autonomousshuttledisengagement"
          autonomousshuttledisengagement-dataset="autonomous-shuttle-disengagement"
        >
          <ods-map
            no-refit="true"
            scroll-wheel-zoom="false"
            basemap="jawg.streets"
            location="16,35.7826,-78.82484"
          >
            <ods-map-layer-group>
              <ods-map-layer
                context="autonomousshuttledisengagement"
                color="#263891"
                picto="ods-circle"
                show-marker="true"
                display="clusters"
                function="COUNT"
                expression="vehicle_speed"
                shape-opacity="0.5"
                point-opacity="1"
                border-color="#FFFFFF"
                border-opacity="1"
                border-size="1"
                border-pattern="solid"
                caption-picto-color="#E5E5E5"
                size-min="3"
                size-max="5"
                size-function="linear"
              ></ods-map-layer>
            </ods-map-layer-group>
          </ods-map>
        </ods-dataset-context>
      </div>
    </div>
  </div>
</section>
